<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calc67</title>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body id="body-calc">

    <div class="music-player-wrapper">
        <div class="music-player-container">
            
            <div class="player-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-music"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
            </div>

            <div class="youtube-embed-wrapper">
                <iframe
                    class="youtube-iframe"
                    src="https://www.youtube-nocookie.com/embed/41nREvWSTyg?list=PLtUOgklcCF2yZBHr80NKtIyZXdnJhEHJ2&autoplay=1&mute=1&loop=1&color=white&modestbranding=1"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                    title="YouTube Playlist Embed"
                    referrerPolicy="strict-origin-when-cross-origin"
                ></iframe>
            </div>
        </div>
    </div>
    <div id="app">
        <h1>Calc67</h1>
        <p class="target-label">Target: <span id="target-display">67</span></p>
        
        <div id="profile-box" class="profile-box" onclick="toggleLeaderboardModal(true)">
            <span class="profile-tag" id="profile-tag">--</span>
            <span class="profile-info">Click to view Leaderboard</span>
        </div>
        
        <div id="loading">Loading daily challenge...</div>

        <div id="game-container" class="hidden">
            
            <div class="calculator-display">
                <div class="current-result-label">CURRENT RESULT (Operand 1)</div>
                <div id="current-result" class="current-result-value">0</div>
            </div>

            <div class="input-container">
                <span class="input-equals">=</span>
                <span id="input-operator" class="input-operator-display font-bold">?</span>
                <span id="input-number" class="input-number-display">0</span>
            </div>
            
            <div class="info-box">
                <div id="starting-number-display" class="info-header"></div>
                <div class="info-footer">
                    <div id="op-counter" class="op-counter-text">Operations: 0</div> 
                    <button id="history-button" class="history-button" onclick="toggleModal(true)">History & Share</button>
                </div>
                <div id="message-box" class="message-box">Enter a number and an operation.</div>
            </div>

            <div id="keypad" class="keypad-grid">
                
                <button id="ac-button" class="calc-button clear-button" onclick="handleInput('AC')">AC</button>
                <button id="del-button" class="calc-button clear-button" onclick="handleInput('DEL')">DEL</button>
                <button id="op-div" class="calc-button op-button" onclick="handleInput('/')">/</button>

                <button class="calc-button num-button" onclick="handleInput('7')">7</button>
                <button class="calc-button num-button" onclick="handleInput('8')">8</button>
                <button class="calc-button num-button" onclick="handleInput('9')">9</button>
                <button id="op-mult" class="calc-button op-button" onclick="handleInput('*')">*</button>

                <button class="calc-button num-button" onclick="handleInput('4')">4</button>
                <button class="calc-button num-button" onclick="handleInput('5')">5</button>
                <button class="calc-button num-button" onclick="handleInput('6')">6</button>
                <button id="op-add" class="calc-button op-button" onclick="handleInput('+')">+</button>

                <button class="calc-button num-button" onclick="handleInput('1')">1</button>
                <button class="calc-button num-button" onclick="handleInput('2')">2</button>
                <button class="calc-button num-button" onclick="handleInput('3')">3</button>
                <div class="subtract-placeholder">‚àí</div>

                <button class="calc-button num-button" onclick="handleInput('0')">0</button>
                <button class="calc-button num-button" onclick="handleInput('.')">.</button>
                <button id="apply-button" class="calc-button apply-button" onclick="executeStep()">APPLY</button>
            </div>
        </div>

        <div id="solved-status" class="solved-status-box hidden">
            <h2 class="solved-header">üéâ Challenge Solved! üéâ</h2>
            <p id="solved-expression" class="solved-expression-text"></p>
            <p id="solved-operations" class="solved-operations-text"></p>
            
            <button id="show-leaderboard-button" class="share-button view-leaderboard-button" onclick="toggleLeaderboardModal(true)">
                View Daily Leaderboard
            </button>
        </div>
    </div>

    <div id="history-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="modal-content">
            <div class="modal-header-container">
                <h3>Operation Log</h3>
                <button onclick="toggleModal(false)">&times;</button>
            </div>
            <p id="modal-op-count" class="modal-op-count text-base"></p>
            <ul id="operation-history-list" class="history-list">
                <li class="placeholder">No steps recorded yet.</li>
            </ul>
            <button id="history-share-button" class="share-button" onclick="shareResults()" disabled>
                Copy Score to Share
            </button>
            <p id="history-share-message" class="share-message"></p>
        </div>
    </div>

    <div id="leaderboard-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="modal-content leaderboard-content">
            <div class="modal-header-container">
                <h3>üèÜ Daily Leaderboard</h3>
                <button onclick="toggleLeaderboardModal(false)">&times;</button>
            </div>

            <div id="leaderboard-user-history" class="user-history-box hidden">
                <h4 class="user-history-header">Your Score:</h4>
                <p id="leaderboard-solved-expression" class="solved-expression-text"></p>
                <p id="leaderboard-solved-operations" class="solved-operations-text"></p>
                <button class="share-button copy-score-button" onclick="shareResults()">
                    Copy Score to Share
                </button>
                <p id="leaderboard-share-message" class="share-message"></p>
            </div>

            <div class="leaderboard-container">
                <p class="leaderboard-info">Sorted by **Diversity** then **Steps** (Unique wins!)</p>
                
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Tag</th>
                            <th>Diversity</th>
                            <th>Steps</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <tr><td colspan="4" class="leaderboard-loading">Loading scores...</td></tr>
                    </tbody>
                </table>
            </div>

            <button class="share-button edit-name-button" onclick="updateDisplayName()">
                Change Your Tag (Max 2 Chars)
            </button>
        </div>
    </div>

    <script type="module" src="scripts.js"></script> 

</body>
</html>